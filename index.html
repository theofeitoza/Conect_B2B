{% extends 'admin/layout.html' %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
    <h1>Dashboard do Administrador</h1>
    <p>Bem-vindo ao painel de controle da plataforma Connecta B2B.</p>
    
    <style>
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }
        .stat-card { background-color: #fff; border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-card h4 { margin: 0 0 10px 0; color: #555; font-size: 1rem; } 
        .stat-card p { font-size: 2.5rem; font-weight: bold; color: #0056b3; }
        .chart-container { background-color: #fff; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-top: 30px; }
    </style>

    <div class="analytics-grid">
        <div class="stat-card">
            <h4>Total de Usuários</h4>
            <p>{{ stats.total_users }}</p>
        </div>
        <div class="stat-card">
            <h4>Total de Produtos</h4>
            <p>{{ stats.total_products }}</p>
        </div>
        <div class="stat-card">
            <h4>Total de Cotações</h4>
            <p>{{ stats.total_quotes }}</p>
        </div>
    </div>

    <div class="chart-container">
        <h3>Novos Usuários por Mês</h3>
        <canvas id="usersChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch("{{ url_for('admin.chart_data') }}")
                .then(response => response.json())
                .then(data => {
                    const ctx = document.getElementById('usersChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'Novos Usuários',
                                data: data.data,
                                backgroundColor: 'rgba(0, 123, 255, 0.5)',
                                borderColor: 'rgba(0, 123, 255, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            }
                        }
                    });
                });
        });
    </script>
{% endblock %}